input {
  http {
    host => "0.0.0.0"
    port => 8080
    codec => json
  }
}

filter {
  # اگر فیلد Timestamp داری، به @timestamp نگاشت کن
  if [Timestamp] {
    date {
      match => ["Timestamp", "ISO8601", "yyyy-MM-dd'T'HH:mm:ss.SSSZ"]
      target => "@timestamp"
      remove_field => ["Timestamp"]
    }
  }

  # نرمال‌سازی سطح لاگ
  if [level] {
    mutate { rename => { "level" => "log.level" } }
  } else if [Level] {
    mutate { rename => { "Level" => "log.level" } }
  }

  # برچسب‌های کاربردی
  mutate {
    add_field => { "service.name" => "%{Application}" }
    remove_field => ["@version", "Headers"]
  }
}

output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "logs-%{+YYYY.MM.dd}"
  }
  stdout { codec => rubydebug }   # برای دیباگ
}
